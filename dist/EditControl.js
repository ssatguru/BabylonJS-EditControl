!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("babylonjs"));else if("function"==typeof define&&define.amd)define(["babylonjs"],i);else{var h="object"==typeof exports?i(require("babylonjs")):i(t.BABYLON);for(var s in h)("object"==typeof exports?exports:t)[s]=h[s]}}(window,function(t){return function(t){var i={};function h(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,h),n.l=!0,n.exports}return h.m=t,h.c=i,h.d=function(t,i,s){h.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},h.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},h.t=function(t,i){if(1&i&&(t=h(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.h)return t;var s=Object.create(null);if(h.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)h.d(s,n,function(i){return t[i]}.bind(null,n));return s},h.n=function(t){var i=t&&t.h?function(){return t.default}:function(){return t};return h.d(i,"a",i),i},h.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},h.p="",h(h.s=1)}([function(i,h){i.exports=t},function(t,i,h){"use strict";h.r(i),h.d(i,"EditControl",function(){return u});var s,n=h(0);!function(t){t[t.TRANS=0]="TRANS",t[t.ROT=1]="ROT",t[t.SCALE=2]="SCALE"}(s||(s={}));var u=function(){function t(t,i,h,s,u,e){var f=this;this.u=!0,this.v=!1,this.M=!1,this.L=1,this.A=Math.PI/18,this.j=.4,this.O=1,this.S=.02,this.R=new n.Color3(1,.2,.2),this.T=new n.Color3(.2,1,.2),this.g=new n.Color3(.2,.2,1),this.k=new n.Color3(1,1,1),this.q=new n.Color3(1,1,.2),this.C=.75,this._=!1,this.N=new n.Matrix,this.B=new n.Vector3(0,0,0),this.D=2,this.F=new n.Vector3(0,0,0),this.G=new n.Vector3(0,0,0),this.H="",this.I=!1,this.J=null,this.K=null,this.P=null,this.U=!1,this.V=!1,this.W=!1,this.$=!1,this.tt=new n.Vector3(0,0,0),this.it=new n.Vector3(0,0,0),this.ht=!1,this.st=new n.Vector3(0,0,0),this.nt=.25,this.ut=new n.Vector3(0,0,0),this.rt=new n.Vector3(0,0,0),this.et=new n.Vector3(0,0,0),this.ft=new n.Vector3(0,0,0),this.ot=!1,this.lt=0,this.ct=!1,this.at=!1,this.vt=!1,this.wt=180,this.Mt=new n.Vector3(this.L,this.L,this.L),this.Xt=new n.Vector3(0,0,0),this.Yt=new n.Vector3(0,0,0),this.Zt=new n.Vector3(0,0,0),this.bt=new n.Matrix,this.Lt=t,this.pt=i,this.dt=h,null!=s&&(this.O=s),this.ot=null!==u&&u,this.yt(),null!=e&&(this.S=e),this.At=t.getScene(),this.jt=new r(t,10),t.computeWorldMatrix(!0),this.zt=this.Ot(t),this.St(t),this._=this.xt(t),console.log("lhs rhs issue "+this._),this.Et=new n.Mesh("",this.At),this.Et.rotationQuaternion=n.Quaternion.Identity(),this.Et.visibility=0,this.Et.isPickable=!1,this.Rt(this.At),this.Tt().parent=this.Et,this.gt().parent=this.Et,this.kt=function(t){return f.qt(t)},this.Ct=function(t){return f._t(t)},this.Nt=function(t){return f.Qt(t)},h.addEventListener("pointerdown",this.kt,!1),h.addEventListener("pointerup",this.Ct,!1),h.addEventListener("pointermove",this.Nt,!1),this.Bt=function(){return f.Dt()},this.At.registerBeforeRender(this.Bt)}return t.prototype.getRoot=function(){return this.Et},t.prototype.yt=function(){if(!this.ot&&(null==this.Lt.rotationQuaternion||null==this.Lt.rotationQuaternion))throw"Error: Eulerian is set to false but the mesh's rotationQuaternion is not set."},t.prototype.xt=function(t){var i=!1,h=t.parent;if(null==h)return!1;this.St(h);var s=n.Vector3.Cross(this.rt,this.et);return i=n.Vector3.Dot(s,this.ft)<0,this.St(t),i},t.prototype.Dt=function(){this.Et.position=this.Lt.getAbsolutePivotPoint(),this.Ft(),this.Gt(),this.u?(this.Et.getWorldMatrix().invertToRef(this.N),n.Vector3.TransformCoordinatesToRef(this.pt.position,this.N,this.B),this.Ht.lookAt(this.B,0,0,0,n.Space.LOCAL)):(this.pt.position.subtractToRef(this.Et.position,this.B),this.Ht.lookAt(this.pt.position,0,0,0,n.Space.WORLD)),this.at?this.It():this.ct?this.Jt(this.Kt,this.Pt,this.Ut):this.vt&&this.Jt(this.Vt,this.Wt,this.$t)},t.prototype.Ft=function(){if(this.u)if(null==this.Lt.parent)if(this.ot){var t=this.Lt.rotation;n.Quaternion.RotationYawPitchRollToRef(t.y,t.x,t.z,this.Et.rotationQuaternion)}else this.Et.rotationQuaternion.copyFrom(this.Lt.rotationQuaternion);else{if(this.ti(this.Lt))return;this.Lt.getWorldMatrix().getRotationMatrixToRef(this.bt),n.Quaternion.FromRotationMatrixToRef(this.bt,this.Et.rotationQuaternion)}},t.prototype.ti=function(t){if(null==t.parent)return!1;for(;null!=t.parent;){if(t.parent.scaling.x!=t.parent.scaling.y||t.parent.scaling.y!=t.parent.scaling.z)return!0;t=t.parent}return!1},t.prototype.Gt=function(){this.Et.position.subtractToRef(this.pt.position,this.F),n.Vector3.FromFloatArrayToRef(this.pt.getWorldMatrix().asArray(),8,this.G);var t=n.Vector3.Dot(this.F,this.G)/this.G.length(),i=Math.abs(t/this.D);n.Vector3.FromFloatsToRef(i,i,i,this.Et.scaling)},t.prototype.It=function(){var t=Math.atan(this.B.y/this.B.z);this.B.z>=0?this.ii.rotation.x=-t:this.ii.rotation.x=-t-Math.PI;var i=Math.atan(this.B.x/this.B.z);this.B.z>=0?this.hi.rotation.y=i:this.hi.rotation.y=i+Math.PI;var h=Math.atan(this.B.x/this.B.y);this.B.y>=0?this.si.rotation.z=-h:this.si.rotation.z=-h-Math.PI},t.prototype.Jt=function(t,i,h){var s=this.B;t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,i.rotation.x=0,i.rotation.y=0,i.rotation.z=0,h.rotation.x=0,h.rotation.y=0,h.rotation.z=0,s.x<=0&&s.y>=0&&s.z>=0?(t.rotation.z=3.14,h.rotation.y=3.14):s.x<=0&&s.y>=0&&s.z<=0?(t.rotation.y=3.14,i.rotation.y=3.14,h.rotation.y=3.14):s.x>=0&&s.y>=0&&s.z<=0?(t.rotation.x=3.14,i.rotation.y=3.14):s.x>=0&&s.y<=0&&s.z>=0?(i.rotation.z=3.14,h.rotation.x=3.14):s.x<=0&&s.y<=0&&s.z>=0?(t.rotation.z=3.14,i.rotation.z=3.14,h.rotation.z=3.14):s.x<=0&&s.y<=0&&s.z<=0?(t.rotation.y=3.14,i.rotation.x=3.14,h.rotation.z=3.14):s.x>=0&&s.y<=0&&s.z<=0&&(t.rotation.x=3.14,i.rotation.x=3.14,h.rotation.x=3.14)},t.prototype.switchTo=function(t,i){t.computeWorldMatrix(!0),this.Lt=t,null!=i&&(this.ot=i),this.yt(),this.St(t),this.jt=new r(t,10),this._=this.xt(t),this.refreshBoundingInfo()},t.prototype.switchCamera=function(t){this.pt=t},t.prototype.setUndoCount=function(t){this.jt.setCapacity(t)},t.prototype.undo=function(){var t=this.jt.undo();this.Lt.computeWorldMatrix(!0),this.St(this.Lt),this.ni(t),this.ui(t),this.ri(t)},t.prototype.redo=function(){var t=this.jt.redo();this.Lt.computeWorldMatrix(!0),this.St(this.Lt),this.ni(t),this.ui(t),this.ri(t)},t.prototype.detach=function(){this.dt.removeEventListener("pointerdown",this.kt,!1),this.dt.removeEventListener("pointerup",this.Ct,!1),this.dt.removeEventListener("pointermove",this.Nt,!1),this.At.unregisterBeforeRender(this.Bt),this.removeAllActionListeners(),this.ei()},t.prototype.hide=function(){this.I=!0,this.ct?(this.H="T",this.disableTranslation()):this.at?(this.H="R",this.disableRotation()):this.vt&&(this.H="S",this.disableScaling()),this.fi()},t.prototype.fi=function(){this.oi.visibility=0,this.li.visibility=0,this.ci.visibility=0},t.prototype.ai=function(){this.oi.visibility=this.C,this.li.visibility=this.C,this.ci.visibility=this.C},t.prototype.show=function(){this.I=!1,this.ai(),"T"==this.H?this.enableTranslation():"R"==this.H?this.enableRotation():"S"==this.H&&this.enableScaling()},t.prototype.isHidden=function(){return this.I},t.prototype.ei=function(){this.Et.dispose(),this.vi(),this.jt=null},t.prototype.addActionListener=function(t){this.J=t},t.prototype.removeActionListener=function(){this.J=null},t.prototype.addActionStartListener=function(t){this.K=t},t.prototype.removeActionStartListener=function(){this.K=null},t.prototype.addActionEndListener=function(t){this.P=t},t.prototype.removeActionEndListener=function(){this.P=null},t.prototype.removeAllActionListeners=function(){this.J=null,this.K=null,this.P=null},t.prototype.qt=function(t){var i=this;if(t.preventDefault(),this.U=!0,0==t.button){var h=this.At.getEngine(),s=[h.isPointerLock?.5*h.getRenderingCanvas().width:this.At.pointerX,h.isPointerLock?.5*h.getRenderingCanvas().height:this.At.pointerY],n=this.At.pick(s[0],s[1],function(t){if(i.ct){if(t==i.wi||t==i.Mi||t==i.Xi||t==i.Kt||t==i.Pt||t==i.Ut||t==i.Yi)return!0}else if(i.at){if(t==i.ii||t==i.hi||t==i.si||t==i.Zi)return!0}else if(i.vt&&(t==i.bi||t==i.Li||t==i.pi||t==i.Vt||t==i.Wt||t==i.$t||t==i.di))return!0;return!1},null,this.pt);if(n.hit){this.yi=n.pickedMesh;var u=this.yi.getChildren();u.length>0?u[0].visibility=this.C:this.yi.visibility=this.C;var r=this.yi.name;"X"==r?this.Ai.visibility=1:"Y"==r?this.ji.visibility=1:"Z"==r?this.zi.visibility=1:"XZ"==r?(this.Ai.visibility=1,this.zi.visibility=1):"ZY"==r?(this.zi.visibility=1,this.ji.visibility=1):"YX"==r?(this.ji.visibility=1,this.Ai.visibility=1):"ALL"==r&&(this.Ai.visibility=1,this.ji.visibility=1,this.zi.visibility=1),this.mi(!0),this.Oi=this.Si(this.yi),null!=this.Oi?this.xi=this.Ei():this.xi=null,window.setTimeout(function(t,h){return i.Ri(t,h)},0,this.pt,this.dt)}}},t.prototype.mi=function(t){this.W=t,t?(this.Ti(),this.gi==s.ROT&&(this.lt=0),this.ni(this.gi)):this.ri(this.gi)},t.prototype.isEditing=function(){return this.W},t.prototype.Ri=function(t,i){var h=t,s=i;this.At.getEngine().isPointerLock||h.detachControl(s)},t.prototype.isPointerOver=function(){return this.V},t.prototype.ki=function(){var t=this,i=this.At.getEngine(),h=[i.isPointerLock?.5*i.getRenderingCanvas().width:this.At.pointerX,i.isPointerLock?.5*i.getRenderingCanvas().height:this.At.pointerY],s=this.At.pick(h[0],h[1],function(i){if(t.ct){if(i==t.wi||i==t.Mi||i==t.Xi||i==t.Kt||i==t.Pt||i==t.Ut||i==t.Yi)return!0}else if(t.at){if(i==t.ii||i==t.hi||i==t.si||i==t.Zi)return!0}else if(t.vt&&(i==t.bi||i==t.Li||i==t.pi||i==t.Vt||i==t.Wt||i==t.$t||i==t.di))return!0;return!1},null,this.pt);if(s.hit){if(s.pickedMesh!=this.qi){if(this.V=!0,this.Ci(),this.qi=s.pickedMesh,this.at)this._i=this.qi.getChildren()[0].color,this.qi.getChildren()[0].color=this.k;else{var n=this.qi.getChildren();n.length>0?(this.Ni=n[0].material,n[0].material=this.Qi):(this.Ni=this.qi.material,this.qi.material=this.Qi)}"X"==this.qi.name?this.oi.color=this.k:"Y"==this.qi.name?this.li.color=this.k:"Z"==this.qi.name&&(this.ci.color=this.k)}}else this.V=!1,null!=this.qi&&(this.Bi(this.qi),this.qi=null)},t.prototype.Ci=function(){null!=this.qi&&(this.qi.visibility=0,this.Bi(this.qi))},t.prototype.Bi=function(t){switch(t.name){case"X":this.oi.color=this.R;break;case"Y":this.li.color=this.T;break;case"Z":this.ci.color=this.g}if(this.at)t.getChildren()[0].color=this._i;else{var i=t.getChildren();i.length>0?i[0].material=this.Ni:t.material=this.Ni}},t.prototype._t=function(t){(this.U=!1,this.W)&&(this.At.getEngine().isPointerLock||this.pt.attachControl(this.dt),this.mi(!1),this.Di(),null!=this.qi&&(this.Bi(this.qi),this.qi=null),this.jt.add(this.gi))},t.prototype.Ti=function(){this.ct?this.gi=s.TRANS:this.at?this.gi=s.ROT:this.vt&&(this.gi=s.SCALE)},t.prototype.ui=function(t){null!=this.J&&this.J(t)},t.prototype.ni=function(t){null!=this.K&&this.K(t)},t.prototype.ri=function(t){null!=this.P&&this.P(t)},t.prototype.Qt=function(t){if(this.U){if(this.W&&null!=this.xi){var i=this.Ei();if(null!=i){if(this.at)this.Fi(this.Lt,this.yi,i,this.xi);else{var h=i.subtract(this.xi);if(0==h.x&&0==h.y&&0==h.z)return;this.ct?this.Gi(h):this.vt&&this.u&&this.Hi(h)}this.xi=i,this.ui(this.gi)}}}else this.ki()},t.prototype.Si=function(t){var i=t.name;if(this.ct||this.vt){if("XZ"==i)return this.Ii;if("ZY"==i)return this.Ji;if("YX"==i)return this.Ki;if("ALL"==i)return this.Ht;this.Et.getWorldMatrix().invertToRef(this.N),n.Vector3.TransformCoordinatesToRef(this.pt.position,this.N,this.B);var h=this.B;if("X"===i)return Math.abs(h.y)>Math.abs(h.z)?this.Ii:this.Ki;if("Z"===i)return Math.abs(h.y)>Math.abs(h.x)?this.Ii:this.Ji;if("Y"===i)return Math.abs(h.z)>Math.abs(h.x)?this.Ki:this.Ji}else{if(!this.at)return null;this.$=!1,this.Et.getWorldMatrix().invertToRef(this.N),n.Vector3.TransformCoordinatesToRef(this.pt.position,this.N,this.B);h=this.B;switch(i){case"X":return Math.abs(h.x)<.2?(this.$=!0,this.Ht):this.Ji;case"Y":return Math.abs(h.y)<.2?(this.$=!0,this.Ht):this.Ii;case"Z":return Math.abs(h.z)<.2?(this.$=!0,this.Ht):this.Ki;default:return this.Ht}}},t.prototype.Gi=function(t){null!=this.Lt.parent&&this.ti(this.Lt)?this.St(this.Et):this.St(this.Lt);var i=this.yi.name;this.tt.x=0,this.tt.y=0,this.tt.z=0,"X"!=i&&"XZ"!=i&&"YX"!=i&&"ALL"!=i||(this.u?this.tt.x=n.Vector3.Dot(t,this.rt)/this.rt.length():this.tt.x=t.x),"Y"!=i&&"ZY"!=i&&"YX"!=i&&"ALL"!=i||(this.u?this.tt.y=n.Vector3.Dot(t,this.et)/this.et.length():this.tt.y=t.y),"Z"!=i&&"XZ"!=i&&"ZY"!=i&&"ALL"!=i||(this.u?this.tt.z=n.Vector3.Dot(t,this.ft)/this.ft.length():this.tt.z=t.z),this.Pi(this.Lt,this.tt,this.u),this.Ui&&(this.Lt.position.x=Math.max(this.Lt.position.x,this.Ui.x),this.Lt.position.y=Math.max(this.Lt.position.y,this.Ui.y),this.Lt.position.z=Math.max(this.Lt.position.z,this.Ui.z)),this.Vi&&(this.Lt.position.x=Math.min(this.Lt.position.x,this.Vi.x),this.Lt.position.y=Math.min(this.Lt.position.y,this.Vi.y),this.Lt.position.z=Math.min(this.Lt.position.z,this.Vi.z)),this.Lt.computeWorldMatrix(!0)},t.prototype.Pi=function(t,i,h){if(this.v){var s=!1;if(this.it.addInPlace(i),Math.abs(this.it.x)>this.Mt.x&&(this.it.x>0?i.x=this.Mt.x:i.x=-this.Mt.x,s=!0),Math.abs(this.it.y)>this.Mt.y&&(this.it.y>0?i.y=this.Mt.y:i.y=-this.Mt.y,s=!0),Math.abs(this.it.z)>this.Mt.z&&(this.it.z>0?i.z=this.Mt.z:i.z=-this.Mt.z,s=!0),!s)return;Math.abs(i.x)!==this.Mt.x&&(i.x=0),Math.abs(i.y)!==this.Mt.y&&(i.y=0),Math.abs(i.z)!==this.Mt.z&&(i.z=0),n.Vector3.FromFloatsToRef(0,0,0,this.it),s=!1}h?(this.rt.normalizeToRef(this.Xt),this.et.normalizeToRef(this.Yt),this.ft.normalizeToRef(this.Zt),this.Lt.translate(this.Xt,i.x,n.Space.WORLD),this.Lt.translate(this.Yt,i.y,n.Space.WORLD),this.Lt.translate(this.Zt,i.z,n.Space.WORLD)):null==this.Lt.parent?this.Lt.position.addInPlace(i):this.Lt.setAbsolutePosition(i.addInPlace(this.Lt.absolutePosition))},t.prototype.Hi=function(t){this.St(this.Lt),this.ut.x=0,this.ut.y=0,this.ut.z=0;var i=this.yi.name;"X"!=i&&"XZ"!=i&&"YX"!=i||(this.ut.x=n.Vector3.Dot(t,this.rt)/this.rt.length(),this.Lt.scaling.x<0&&(this.ut.x=-this.ut.x)),"Y"!=i&&"ZY"!=i&&"YX"!=i||(this.ut.y=n.Vector3.Dot(t,this.et)/this.et.length(),this.Lt.scaling.y<0&&(this.ut.y=-this.ut.y)),"Z"!=i&&"XZ"!=i&&"ZY"!=i||(this.ut.z=n.Vector3.Dot(t,this.ft)/this.ft.length(),this.Lt.scaling.z<0&&(this.ut.z=-this.ut.z));var h=this.zt;if(this.ut.x=this.ut.x/h.x,this.ut.y=this.ut.y/h.y,this.ut.z=this.ut.z/h.z,"ALL"==i){var s=n.Vector3.Dot(t,this.pt.upVector);s/=Math.max(h.x,h.y,h.z),this.ut.copyFromFloats(s,s,s)}else{var u=!1;if("XZ"==i?(u=!0,Math.abs(this.ut.x)>Math.abs(this.ut.z)?this.ut.z=this.ut.x:this.ut.x=this.ut.z):"ZY"==i?(u=!0,Math.abs(this.ut.z)>Math.abs(this.ut.y)?this.ut.y=this.ut.z:this.ut.z=this.ut.y):"YX"==i&&(u=!0,Math.abs(this.ut.y)>Math.abs(this.ut.x)?this.ut.x=this.ut.y:this.ut.y=this.ut.x),u){this.Et.position.subtractToRef(this.pt.position,this.F);s=n.Vector3.Dot(t,this.F);this.ut.x=Math.abs(this.ut.x),this.ut.y=Math.abs(this.ut.y),this.ut.z=Math.abs(this.ut.z),s>0?(this.Lt.scaling.x>0&&(this.ut.x=-this.ut.x),this.Lt.scaling.y>0&&(this.ut.y=-this.ut.y),this.Lt.scaling.z>0&&(this.ut.z=-this.ut.z)):(this.Lt.scaling.x<0&&(this.ut.x=-this.ut.x),this.Lt.scaling.y<0&&(this.ut.y=-this.ut.y),this.Lt.scaling.z<0&&(this.ut.z=-this.ut.z))}}this.Wi(this.Lt,this.ut),this.$i&&(this.Lt.scaling.x=Math.max(this.Lt.scaling.x,this.$i.x),this.Lt.scaling.y=Math.max(this.Lt.scaling.y,this.$i.y),this.Lt.scaling.z=Math.max(this.Lt.scaling.z,this.$i.z)),this.th&&(this.Lt.scaling.x=Math.min(this.Lt.scaling.x,this.th.x),this.Lt.scaling.y=Math.min(this.Lt.scaling.y,this.th.y),this.Lt.scaling.z=Math.min(this.Lt.scaling.z,this.th.z))},t.prototype.Wi=function(t,i){if(this.ht){var h=!1;if(this.st.addInPlace(i),Math.abs(this.st.x)>this.nt&&(i.x>0?i.x=this.nt:i.x=-this.nt,h=!0),Math.abs(this.st.y)>this.nt&&(i.y>0?i.y=this.nt:i.y=-this.nt,h=!0),Math.abs(this.st.z)>this.nt&&(i.z>0?i.z=this.nt:i.z=-this.nt,h=!0),!h)return;Math.abs(i.x)!==this.nt&&0!==i.x&&(i.x=0),Math.abs(i.y)!==this.nt&&0!==i.y&&(i.y=0),Math.abs(i.z)!==this.nt&&0!==i.z&&(i.z=0),n.Vector3.FromFloatsToRef(0,0,0,this.st),h=!1}t.scaling.addInPlace(i)},t.prototype.St=function(t){var i=t.getWorldMatrix();n.Vector3.FromFloatArrayToRef(i.m,0,this.rt),n.Vector3.FromFloatArrayToRef(i.m,4,this.et),n.Vector3.FromFloatArrayToRef(i.m,8,this.ft)},t.prototype.Ot=function(t){if(t instanceof n.AbstractMesh){var i=t.getBoundingInfo().boundingBox,h=i.maximum.subtract(i.minimum);return 0==h.x&&(h.x=1),0==h.y&&(h.y=1),0==h.z&&(h.z=1),h}return new n.Vector3(1,1,1)},t.prototype.refreshBoundingInfo=function(){this.zt=this.Ot(this.Lt)},t.prototype.Fi=function(t,i,h,s){this.u&&null!=this.Lt.parent&&this.ti(t)?this.St(this.Et):this.St(t);var u,r=0;i==this.ii?u=this.u?this.rt:n.Axis.X:i==this.hi?u=this.u?this.et:n.Axis.Y:i==this.si&&(u=this.u?this.ft:n.Axis.Z),this.Et.position.subtractToRef(this.pt.position,this.F),this.$?(r=this.ih(s,h,this.pt.position,this.F,u),this.At.useRightHandedSystem&&(r=-r)):r=this.hh(s,h,t.getAbsolutePivotPoint(),this.F),this._&&(r=-r),this.M&&(this.lt+=r,r=0,Math.abs(this.lt)>=this.A&&(r=this.lt>0?this.A:-this.A,this.lt=0)),0!==r&&(this.F.normalize(),i==this.Zi?t.rotate(this.F,-r,n.Space.WORLD):(n.Vector3.Dot(u,this.F)>=0&&(r=-r),t.rotate(u,r,n.Space.WORLD)),this.ot&&(t.rotation=t.rotationQuaternion.toEulerAngles(),t.rotationQuaternion=null),this.u&&(this._&&(r=-r),null!=this.Lt.parent&&this.ti(t)&&(i==this.Zi?this.Et.rotate(this.F,-r,n.Space.WORLD):this.Et.rotate(u,r,n.Space.WORLD))))},t.prototype.Ei=function(){var t=this,i=this.At.getEngine(),h=[i.isPointerLock?.5*i.getRenderingCanvas().width:this.At.pointerX,i.isPointerLock?.5*i.getRenderingCanvas().height:this.At.pointerY],s=this.At.pick(h[0],h[1],function(i){return i==t.Oi},null,this.pt);return s.hit?s.pickedPoint:null},t.prototype.Di=function(){this.Ai.visibility=0,this.ji.visibility=0,this.zi.visibility=0},t.prototype.getRotationQuaternion=function(){return this.Et.rotationQuaternion},t.prototype.getPosition=function(){return this.Et.position},t.prototype.isTranslationEnabled=function(){return this.ct},t.prototype.enableTranslation=function(){this.I||(null==this.wi&&(this.sh(),this.nh.parent=this.Et),this.Ci(),this.ct||(this.uh(this.rh,this.C),this.ct=!0,this.disableRotation(),this.disableScaling()))},t.prototype.disableTranslation=function(){this.ct&&(this.uh(this.rh,0),this.ct=!1)},t.prototype.isRotationEnabled=function(){return this.at},t.prototype.returnEuler=function(t){this.ot=t},t.prototype.enableRotation=function(){this.I||(null==this.eh&&(this.fh(),this.eh.parent=this.Et),this.Ci(),this.at||(this.uh(this.oh,this.C),this.at=!0,this.disableTranslation(),this.disableScaling()))},t.prototype.disableRotation=function(){this.at&&(this.uh(this.oh,0),this.at=!1)},t.prototype.isScalingEnabled=function(){return this.vt},t.prototype.enableScaling=function(){this.I||(null==this.bi&&(this.lh(),this.ah.parent=this.Et),this.Ci(),this.vt||(this.uh(this.vh,this.C),this.vt=!0,this.disableTranslation(),this.disableRotation()))},t.prototype.disableScaling=function(){this.vt&&(this.uh(this.vh,0),this.vt=!1)},t.prototype.setScaleBounds=function(t,i){this.$i=t||null,this.th=i||null,null!=this.$i&&(0==this.$i.x&&(this.$i.x=1e-8),0==this.$i.y&&(this.$i.y=1e-8),0==this.$i.z&&(this.$i.z=1e-8))},t.prototype.removeScaleBounds=function(){this.$i=null,this.th=null},t.prototype.setTransBounds=function(t,i){this.Ui=t||null,this.Vi=i||null},t.prototype.removeTransBounds=function(){this.Ui=null,this.Vi=null},t.prototype.setRotBounds=function(t,i){this.wh=t||null,this.Mh=i||null},t.prototype.removeRotBounds=function(){this.wh=null,this.Mh=null},t.prototype.Tt=function(){var t=new n.Mesh("",this.At);this.Ai=n.Mesh.CreateLines("",[new n.Vector3(-100,0,0),new n.Vector3(100,0,0)],this.At),this.ji=n.Mesh.CreateLines("",[new n.Vector3(0,-100,0),new n.Vector3(0,100,0)],this.At),this.zi=n.Mesh.CreateLines("",[new n.Vector3(0,0,-100),new n.Vector3(0,0,100)],this.At),this.Ai.isPickable=!1,this.ji.isPickable=!1,this.zi.isPickable=!1,this.Ai.parent=t,this.ji.parent=t,this.zi.parent=t,this.Ai.color=this.R,this.ji.color=this.T,this.zi.color=this.g,this.Di();var i=this.j*this.O*.75;return this.oi=n.Mesh.CreateLines("",[new n.Vector3(0,0,0),new n.Vector3(i,0,0)],this.At),this.li=n.Mesh.CreateLines("",[new n.Vector3(0,0,0),new n.Vector3(0,i,0)],this.At),this.ci=n.Mesh.CreateLines("",[new n.Vector3(0,0,0),new n.Vector3(0,0,i)],this.At),this.oi.isPickable=!1,this.li.isPickable=!1,this.ci.isPickable=!1,this.oi.parent=t,this.li.parent=t,this.ci.parent=t,this.oi.color=this.R,this.li.color=this.T,this.ci.color=this.g,this.oi.renderingGroupId=1,this.li.renderingGroupId=1,this.ci.renderingGroupId=1,t},t.prototype.gt=function(){this.Ht=n.Mesh.CreatePlane("",5,this.At),this.Ii=n.Mesh.CreatePlane("",5,this.At),this.Ji=n.Mesh.CreatePlane("",5,this.At),this.Ki=n.Mesh.CreatePlane("",5,this.At),this.Ht.isPickable=!1,this.Ii.isPickable=!1,this.Ji.isPickable=!1,this.Ki.isPickable=!1,this.Ht.visibility=0,this.Ii.visibility=0,this.Ji.visibility=0,this.Ki.visibility=0,this.Ht.renderingGroupId=1,this.Ii.renderingGroupId=1,this.Ji.renderingGroupId=1,this.Ki.renderingGroupId=1,this.Ht.lookAt(this.pt.position),this.Ii.rotate(n.Axis.X,1.57),this.Ji.rotate(n.Axis.Y,1.57);var t=new n.Mesh("",this.At);return this.Ht.parent=t,this.Ii.parent=t,this.Ji.parent=t,this.Ki.parent=t,t},t.prototype.sh=function(){var t=2*this.S*this.O,i=this.j*this.O;this.nh=new n.Mesh("",this.At),this.Xh(t,i,this.nh,this.At),this.Yh(t,i,this.At)},t.prototype.Xh=function(t,i,h,s){var u=this.Zh(t/2,i);u.name="X";var r=u.clone("Y"),e=u.clone("Z"),f=n.MeshBuilder.CreatePlane("XZ",{size:2*t},s),o=n.MeshBuilder.CreatePlane("ZY",{size:2*t},s),l=n.MeshBuilder.CreatePlane("YX",{size:2*t},s);f.rotation.x=1.57,o.rotation.y=-1.57,f.position.x=2*t,f.position.z=2*t,o.position.z=2*t,o.position.y=2*t,l.position.y=2*t,l.position.x=2*t,f.bakeCurrentTransformIntoVertices(),o.bakeCurrentTransformIntoVertices(),l.bakeCurrentTransformIntoVertices();var c=n.Mesh.CreateBox("ALL",2*t,s);u.parent=h,r.parent=h,e.parent=h,f.parent=h,o.parent=h,l.parent=h,c.parent=h,u.rotation.y=1.57,r.rotation.x-=1.57,this.wi=u,this.Mi=r,this.Xi=e,this.Kt=f,this.Pt=o,this.Ut=l,this.Yi=c,this.bh=[u,r,e,f,o,l,c],this.uh(this.bh,0),this.Lh(this.bh)},t.prototype.Yh=function(t,i,h){var s=i/5,u=n.Mesh.CreateCylinder("",s,0,t,6,1,h),r=u.clone(""),e=u.clone(""),f=2*t,o=n.MeshBuilder.CreatePlane("XZ",{size:f},h),l=n.MeshBuilder.CreatePlane("ZY",{size:f},h),c=n.MeshBuilder.CreatePlane("YX",{size:f},h),a=n.Mesh.CreateBox("ALL",t,h);u.rotation.x=1.57,r.rotation.x=1.57,e.rotation.x=1.57,o.rotation.x=1.57,l.rotation.y=1.57,o.position.x=f,o.position.z=f,l.position.z=f,l.position.y=f,c.position.y=f,c.position.x=f,u.parent=this.wi,r.parent=this.Mi,e.parent=this.Xi,o.parent=this.Kt,l.parent=this.Pt,c.parent=this.Ut,a.parent=this.Yi,u.position.z=i-s/2,r.position.z=i-s/2,e.position.z=i-s/2,u.material=this.ph,r.material=this.dh,e.material=this.yh,o.material=this.dh,l.material=this.ph,c.material=this.yh,a.material=this.Ah,this.jh=u,this.zh=r,this.mh=e,this.Oh=o,this.Sh=l,this.xh=c,this.Eh=a,this.rh=[u,r,e,o,l,c,a],this.Lh(this.rh),this.Rh(this.rh)},t.prototype.setRotGuideFull=function(t){this.wt=t?360:180,null!=this.eh&&(this.eh.dispose(),this.Zi.dispose(),this.eh=null,this.enableRotation())},t.prototype.fh=function(){var t=this.j*this.O*2;this.eh=new n.Mesh("",this.At),this.Th(t,this.eh),this.gh(t)},t.prototype.Th=function(t,i){var h=this.kh(t/2,this.wt),s=this.kh(t/2,this.wt),n=this.kh(t/2,this.wt),u=this.kh(t/1.75,360);h.name="X",s.name="Y",n.name="Z",u.name="ALL",h.rotation.z=1.57,n.rotation.x=-1.57,h.bakeCurrentTransformIntoVertices(),n.bakeCurrentTransformIntoVertices(),u.rotation.x=1.57,h.parent=i,s.parent=i,n.parent=i,u.parent=this.Ht,this.ii=h,this.hi=s,this.si=n,this.Zi=u,this.qh=[h,s,n,u],this.uh(this.qh,0),this.Lh(this.qh)},t.prototype.gh=function(t){var i=this.Ch(t/2,this.wt,!1),h=i.clone(""),s=i.clone(""),u=this.Ch(t/1.75,360,!1),r=this.Ch(t/2,360,!1);i.parent=this.ii,h.parent=this.hi,s.parent=this.si,i.rotation.z=1.57,s.rotation.x=-1.57,u.parent=this.Zi,r.parent=this.Zi,i.color=this.R,h.color=this.T,s.color=this.g,u.color=this.q,r.color=n.Color3.Gray(),this._h=i,this.Nh=h,this.Qh=s,this.Bh=u,this.Dh=r,this.oh=[i,h,s,u,r],this.Lh(this.oh),this.Rh(this.oh)},t.prototype.uh=function(t,i){t.map(function(t){return t.visibility=i})},t.prototype.Lh=function(t){t.map(function(t){t.isPickable=!1})},t.prototype.Rh=function(t){t.map(function(t){return t.renderingGroupId=2})},t.prototype.Zh=function(t,i){var h=[new n.Vector3(t,t,0),new n.Vector3(-t,t,0),new n.Vector3(-t,-t,0),new n.Vector3(t,-t,0),new n.Vector3(t,t,0)],s=[new n.Vector3(0,0,0),new n.Vector3(0,0,i)];return n.Mesh.ExtrudeShape("",h,s,1,0,2,this.At)},t.prototype.Ch=function(t,i,h){null===i&&(i=360);for(var s,u,r=[],e=3.14/180,f=0,o=0;o<=i;o+=5)s=t*Math.cos(o*e),u=90==o?t:270==o?-t:t*Math.sin(o*e),r[f]=new n.Vector3(s,0,u),f++;if(h){t-=.04;for(o=0;o<=i;o+=5)s=t*Math.cos(o*e),u=90==o?t:270==o?-t:t*Math.sin(o*e),r[f]=new n.Vector3(s,0,u),f++}return n.Mesh.CreateLines("",r,this.At)},t.prototype.kh=function(t,i){null===i&&(i=360);for(var h,s,u=[],r=3.14/180,e=0,f=0;f<=i;f+=30)h=t*Math.cos(f*r),s=90==f?t:270==f?-t:t*Math.sin(f*r),u[e]=new n.Vector3(h,0,s),e++;return n.Mesh.CreateTube("",u,this.S*this.O*2,3,null,n.Mesh.NO_CAP,this.At)},t.prototype.lh=function(){var t=2*this.S*this.O,i=this.j*this.O;this.ah=new n.Mesh("",this.At),this.Fh(t,i,this.ah),this.Gh(t,i)},t.prototype.Fh=function(t,i,h){var s=this.Zh(t/2,i);s.name="X";var u=s.clone("Y"),r=s.clone("Z"),e=n.MeshBuilder.CreatePlane("XZ",{size:2*t},this.At),f=n.MeshBuilder.CreatePlane("ZY",{size:2*t},this.At),o=n.MeshBuilder.CreatePlane("YX",{size:2*t},this.At);e.rotation.x=1.57,f.rotation.y=-1.57,e.position.x=2*t,e.position.z=2*t,f.position.z=2*t,f.position.y=2*t,o.position.y=2*t,o.position.x=2*t,e.bakeCurrentTransformIntoVertices(),f.bakeCurrentTransformIntoVertices(),o.bakeCurrentTransformIntoVertices();var l=n.Mesh.CreateBox("ALL",2*t,this.At);s.parent=h,u.parent=h,r.parent=h,l.parent=h,e.parent=h,f.parent=h,o.parent=h,s.rotation.y=1.57,u.rotation.x-=1.57,this.bi=s,this.Li=u,this.pi=r,this.Vt=e,this.Wt=f,this.$t=o,this.di=l,this.Hh=[s,u,r,e,f,o,l],this.uh(this.Hh,0),this.Lh(this.Hh)},t.prototype.Gh=function(t,i){var h=n.Mesh.CreateBox("",t,this.At),s=h.clone(""),u=h.clone(""),r=2*t,e=n.MeshBuilder.CreatePlane("XZ",{size:r},this.At),f=n.MeshBuilder.CreatePlane("ZY",{size:r},this.At),o=n.MeshBuilder.CreatePlane("YX",{size:r},this.At),l=n.Mesh.CreateBox("ALL",t,this.At);e.rotation.x=1.57,f.rotation.y=-1.57,e.position.x=r,e.position.z=r,f.position.z=r,f.position.y=r,o.position.y=r,o.position.x=r,h.parent=this.bi,s.parent=this.Li,u.parent=this.pi,e.parent=this.Vt,f.parent=this.Wt,o.parent=this.$t,l.parent=this.di,h.position.z=i-t/2,s.position.z=i-t/2,u.position.z=i-t/2,h.material=this.ph,s.material=this.dh,u.material=this.yh,e.material=this.dh,f.material=this.ph,o.material=this.yh,l.material=this.Ah,this.Ih=h,this.Jh=s,this.Kh=u,this.Ph=e,this.Uh=f,this.Vh=o,this.Wh=l,this.vh=[h,s,u,e,f,o,l],this.Lh(this.vh),this.Rh(this.vh)},t.prototype.setVisibility=function(t){this.C=t},t.prototype.setLocal=function(t){this.u!=t&&(this.u=t,t||(this.Et.rotationQuaternion=n.Quaternion.Identity()))},t.prototype.isLocal=function(){return this.u},t.prototype.setTransSnap=function(t){this.v=t},t.prototype.setRotSnap=function(t){this.M=t},t.prototype.setScaleSnap=function(t){this.ht=t},t.prototype.setTransSnapValue=function(t){this.Mt.copyFromFloats(t,t,t),this.L=t},t.prototype.setRotSnapValue=function(t){this.A=t},t.prototype.setScaleSnapValue=function(t){this.nt=t},t.prototype.ih=function(t,i,h,s,u){var r=n.Vector3.Dot(s,u);u.scaleToRef(r,this.Xt),h.addToRef(this.Xt,this.Yt);var e=this.Yt;this.pt.getWorldMatrix().invertToRef(this.bt),n.Vector3.TransformCoordinatesToRef(this.Yt,this.bt,this.Yt);var f=0;e.x>=0&&e.y>=0?f=1:e.x<=0&&e.y>=0?f=2:e.x<=0&&e.y<=0?f=3:e.x>=0&&e.y<=0&&(f=4),n.Vector3.TransformCoordinatesToRef(t,this.bt,this.Xt),n.Vector3.TransformCoordinatesToRef(i,this.bt,this.Yt),this.Yt.subtractInPlace(this.Xt);var o=this.Yt,l=o.length(),c="";o.x>=0&&o.y>=0?c=o.x>=o.y?"r":"u":o.x<=0&&o.y>=0?c=-o.x>=o.y?"l":"u":o.x<=0&&o.y<=0?c=-o.x>=-o.y?"l":"d":o.x>=0&&o.y<=0&&(c=o.x>=-o.y?"r":"d");var a=0;return"d"==c?a=1==f||4==f?1:-1:"u"==c?a=1==f||4==f?-1:1:"r"==c?a=2==f||1==f?1:-1:"l"==c&&(a=2==f||1==f?-1:1),a*l},t.prototype.hh=function(t,i,h,s){t.subtractToRef(h,this.Xt),i.subtractToRef(h,this.Yt),n.Vector3.CrossToRef(this.Xt,this.Yt,this.Zt);var u=Math.asin(this.Zt.length()/(this.Xt.length()*this.Yt.length()));return n.Vector3.Dot(this.Zt,s)>0&&(u*=-1),u},t.$h=function(t,i){var h=new n.StandardMaterial("",i);return h.emissiveColor=t,h.diffuseColor=n.Color3.Black(),h.specularColor=n.Color3.Black(),h.backFaceCulling=!1,h},t.prototype.Rt=function(i){this.ph=t.$h(this.R,i),this.dh=t.$h(this.T,i),this.yh=t.$h(this.g,i),this.Qi=t.$h(this.k,i),this.Ah=t.$h(this.q,i)},t.prototype.vi=function(){this.ph.dispose(),this.dh.dispose(),this.yh.dispose(),this.Qi.dispose(),this.Ah.dispose()},t}(),r=function(){function t(t,i){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=t,this.lastMax=i-1,this.add()}return t.prototype.setCapacity=function(t){0!=t?(this.lastMax=t-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()):console.error("capacity should be more than zero")},t.prototype.add=function(t){void 0===t&&(t=null);var i=new e(this.mesh,t);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(i)):(this.acts.push(i),this.last++,this.current++)},t.prototype.undo=function(){if(this.current>0){var t=this.acts[this.current].getActionType();return this.current--,this.acts[this.current].perform(this.mesh),t}},t.prototype.redo=function(){if(this.current<this.last)return this.current++,this.acts[this.current].perform(this.mesh),this.acts[this.current].getActionType()},t}(),e=function(){function t(t,i){this.ts=t.position.clone(),null==t.rotationQuaternion?(this.hs=null,this.ss=t.rotation.clone()):(this.hs=t.rotationQuaternion.clone(),this.ss=null),this.ns=t.scaling.clone(),this.us=i}return t.prototype.getActionType=function(){return this.us},t.prototype.perform=function(t){t.position.copyFrom(this.ts),null==t.rotationQuaternion?null!=this.ss?t.rotation.copyFrom(this.ss):t.rotation.copyFrom(this.hs.toEulerAngles()):null!=this.hs?t.rotationQuaternion.copyFrom(this.hs):t.rotationQuaternion.copyFrom(n.Quaternion.RotationYawPitchRoll(this.ss.y,this.ss.x,this.ss.z)),t.scaling.copyFrom(this.ns)},t}()}])});
//# sourceMappingURL=EditControl.js.map